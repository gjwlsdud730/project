<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>detail</title>
  <!-- jquery cdn -->
  <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
  <!-- bootstrap css -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <!-- bootstrap icon-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>

<div th:replace="~{/layout/layoutdetail :: body}">

  <div th:fragment="content" class="container my-1" style="border: 1px solid #dee2e6; padding: 15px; border-radius: 5px;">
    <div class="row">
      <div class="col-11">
        <div class="box">
          <h3 th:text="${board.boardTitle}"></h3>
          <br>
          <p>작성자: <span th:text="${board.userName}"></span></p>
          <p>작성일자: <span th:text="${#temporals.format(board.boardCreatedTime, 'yyyy-MM-dd HH.mm')}"></span></p>
          <p>조회수: <span th:text="${board.boardHits}"></span></p>
        </div>
        <hr>
        <div class="box" style="min-height: 5em;">
          <p th:utext="${board.boardContents}"></p>
<!--          session 값 확인: <p th:text="${session.userIndex}"></p>-->
          <div th:if="${board.fileAttached == 1}">
            <p th:each="fileName: ${board.storedFileName}">
              <img th:src="@{|/upload/${fileName}|}" alt="">
            </p>
          </div>
        </div>
        <hr>
        <div th:if="${session.userIndex == board.userIndex}">
          <button onclick="updateReq()">수정</button>
          <button onclick="deleteReq()">삭제</button>
          <hr>
        </div>
      </div>
    </div>
  </div>



<!--    &lt;!&ndash; 댓글 작성 부분 &ndash;&gt;-->
<!--    <div id="comment-write">-->
<!--      <input type="text" id="commentWriter" placeholder="작성자">-->
<!--      <input type="text" id="commentContents" placeholder="내용">-->
<!--      <button id="comment-write-btn" onclick="commentWrite()">댓글작성</button>-->
<!--    </div>-->

<!--    &lt;!&ndash; 댓글 출력 부분 &ndash;&gt;-->
<!--    <div id="comment-list">-->
<!--      <table>-->
<!--        <tr>-->
<!--          <th>댓글번호</th>-->
<!--          <th>작성자</th>-->
<!--          <th>내용</th>-->
<!--          <th>작성시간</th>-->
<!--        </tr>-->
<!--        <tr th:each="comment: ${commentList}">-->
<!--          <td th:text="${comment.id}"></td>-->
<!--          <td th:text="${comment.commentWriter}"></td>-->
<!--          <td th:text="${comment.commentContents}"></td>-->
<!--          <td th:text="${comment.commentCreatedTime}"></td>-->
<!--        </tr>-->
<!--      </table>-->
<!--    </div>-->


</div>







</body>
<script th:inline="javascript">
    const commentWrite = () => {
        const writer = document.getElementById("commentWriter").value;
        const contents = document.getElementById("commentContents").value;
        console.log("작성자: ", writer);
        console.log("내용: ", contents);
        const id = [[${board.id}]]; // 게시글 번호
        $.ajax({
           // 요청방식: post, 요청주소: /comment/save, 요청데이터: 작성자, 작성내용, 게시글 번호
            "type": "post",
            "url": "/comment/save",
            data: {
                "commentWriter": writer,
                "commentContents": contents,
                "boardId": id
            },
            success: function (res) {
                console.log("요청성공", res);
                let output = "<table>";
                output += "<tr><th>댓글번호</th>";
                output += "<th>작성자</th>";
                output += "<th>내용</th>";
                output += "<th>작성시간</th></tr>";
                for (let i in res) {
                    output += "<tr>";
                    output += "<td>" + res[i].id + "</td>";
                    output += "<td>" + res[i].commentWriter + "</td>";
                    output += "<td>" + res[i].commentContents + "</td>";
                    output += "<td>" + res[i].commentCreatedTime + "</td>";
                    output += "</tr>";
                }
                output += "</table>";
                document.getElementById('comment-list').innerHTML = output;
                document.getElementById('commentWriter').value = '';
                document.getElementById('commentContents').value = '';
            },
            error: function (err) {
                console.log("요청실패", err);
            }
        });
    }

  const updateReq = () => {
      console.log("수정 요청");
      const id = [[${board.id}]];
      location.href = "/board/update/" + id;
  }
  const deleteReq = () => {
      console.log("삭제 요청");
      const id = [[${board.id}]];
      location.href = "/board/delete/" + id;
  }
</script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</html>